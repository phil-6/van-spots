<%= render partial: 'layouts/alerts' %>
<div class="container">
  <div class="text-center">
    <h2><%= @spot.name %></h2>
    <h6><%= @spot.created_at.strftime('%b %d, %Y') %></h6>
    <h6>Created By: <%= @spot.user.username %></h6>
    <h6>Score: <%= @spot.average_rating %>/10</h6>
    <% if @spot.web_link.present? %><h6><%= link_to 'External Info', @spot.web_link %></h6><% end %>
    <h6><%= link_to 'Directions', 'https://www.google.com/maps/dir/?api=1&destination='+@spot.latitude.to_s+','+@spot.longitude.to_s, target: :_blank %></h6>
  </div>

  <div class="text-center">
    Type:
    <% if @spot.spot_type == 'free_spot' %>Free Spot
    <% elsif @spot.spot_type == 'paid_spot' %>Paid Spot
    <% elsif @spot.spot_type == 'campsite' %>Campsite
    <% elsif @spot.spot_type == 'mtb_spot' %>MTB Spot
    <% elsif @spot.spot_type == 'climbing_spot' %>Climbing Spot
    <% elsif @spot.spot_type == 'kayaking_spot' %>Kayaking Spot
    <% elsif @spot.spot_type == 'surf_spot' %>Surf Spot
    <% elsif @spot.spot_type == 'walking_spot' %>Walking Spot
    <% else %>Spot Type Unknown<% end %>
  </div>

  <div>
    <%= @spot.description %>
  </div>

  <!--Edit if Owner or Admin-->
  <% if current_user.id == @spot.user_id || current_user.admin? %>
    <div class="text-center">
      <%= button_to "Edit Spot", edit_spot_url(@spot), method: :get, class: 'btn btn-sm btn-primary' %>
    </div>
  <% end %>

  <!--Rate Spot-->
  <div class="text-center">
    Stayed here? Leave a rating!
    <%= link_to "Rate Spot", new_spot_rating_path(@spot) %>
  </div>

  <!--Spot Stats-->
  <div>
    <h3>Stats </h3>
    Total Score: <%= @spot.ratings.map(&:score).sum %> <br />
    Total Ratings: <%= @spot.ratings.count %><br />
    Total Reviews: <%= @spot.ratings.map(&:review_title).count(&:present?) %>
  </div>
</div>

<!--Reviews-->
<div class="reviews-container">
  <% if @spot.ratings.map(&:review_title).any?(&:present?) %>
      <h3 class="text-center">Reviews</h3>
      <div class="card-columns">
        <% @spot.ratings.reverse.each do |rating| %>
          <% if rating.review_title? %>
            <div class="card <% if rating.score < 3 %>border-danger<% elsif rating.score < 6 %>border-warning<% elsif rating.score < 8 %>border-info<%else %>border-success<% end %>">

              <div class="card-header <% if rating.score < 3 %>border-danger alert-danger<% elsif rating.score < 6 %>border-warning alert-warning<% elsif rating.score < 8 %>border-info alert-info<%else %>border-success alert-success<% end %>">
                <h5 class="text-center"> <%= rating.score %>/10</h5>
              </div>

              <div class="card-body">
                <h4 class="card-title text-center"><%= rating.review_title %></h4>
                <p class="card-text"><%= rating.review_body %></p>
              </div>

              <div class="card-footer">
                <small class="text-muted">by <%= rating.user.username %> on <%= rating.created_at.strftime('%b %d, %Y') %></small>
              </div>

              <%# if current_user.id == rating.user_id%>
              <!--                      <div class="text-center">-->
              <%#= button_to "Edit Review", edit_spot_rating_url(@spot, rating), method: :get, class: 'btn btn-primary' %>
              <!-- TODO add delete option -->
              <!--                      </div>-->
              <%# end %>
            </div>
          <% end %>
        <% end %>
      </div>
  <% end %>
</div>